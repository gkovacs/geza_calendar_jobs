#!/usr/bin/env node
// Generated by LiveScript 1.4.0
(function(){
  var getsecret, moment, cfy, google, calendar, key, auth, calendarId, delete_passed_events;
  getsecret = require('getsecret');
  moment = require('moment');
  cfy = require('cfy').cfy;
  google = require('googleapis');
  calendar = google.calendar('v3');
  key = JSON.parse(getsecret('google_service_account'));
  auth = new google.auth.JWT(key.client_email, null, key.private_key, ['https://www.googleapis.com/auth/calendar'], null);
  auth.projectId = key.project_id;
  calendarId = getsecret('available_meals_calendar_id');
  delete_passed_events = cfy(function*(){
    var tokens, events, event_list, ref$, i$, len$, evt, start_time, eventId, results$ = [];
    tokens = (yield function(it){
      return auth.authorize(it);
    });
    events = (yield function(it){
      return calendar.events.list({
        auth: auth,
        calendarId: calendarId
      }, {}, it);
    });
    event_list = events != null ? (ref$ = events[0]) != null ? ref$.items : void 8 : void 8;
    for (i$ = 0, len$ = event_list.length; i$ < len$; ++i$) {
      evt = event_list[i$];
      if ((evt != null ? evt.start : void 8) == null) {
        continue;
      }
      start_time = moment(new Date(evt.start.dateTime));
      if (moment().add(1, 'hours') >= start_time) {
        eventId = evt.id;
        results$.push((yield fn$));
      }
    }
    return results$;
    function fn$(it){
      return calendar.events['delete']({
        auth: auth,
        calendarId: calendarId,
        eventId: eventId
      }, it);
    }
  });
  delete_passed_events();
}).call(this);
